name: Agent Deploy
on:
  push:
    branches: [main]
    paths:
      - 'tools/**'
      - 'agents/**'
      - 'blackroad-sf/**'
  workflow_dispatch:
    inputs:
      target:
        description: 'Deploy target (worker/sf/pi)'
        required: true
        default: 'worker'
jobs:
  deploy:
    runs-on: [self-hosted, pi]
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
      - name: Setup Node
        uses: actions/setup-node@1d0ff469b7ec7b3cb9d8673fde0c81c44821de2a
        with:
          node-version: '20'
      - name: Log deploy event
        run: |
          echo "{\"ts\":\"$(date -u +%Y-%m-%dT%H:%M:%SZ)\",\"action\":\"deploy\",\"entity\":\"${{ github.ref_name }}\",\"detail\":\"Triggered by push to ${{ github.ref_name }}\"}" >> memory/journals/master-journal.jsonl || true
          echo "Deploy triggered for: ${{ github.event.inputs.target || 'auto' }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"
