name: Continuous 24h Loop

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Daily fallback trigger

concurrency:
  group: continuous-loop
  cancel-in-progress: false

jobs:
  run-and-requeue:
    runs-on: [self-hosted, Linux, blackroad]
    timeout-minutes: 1450  # ~24h 10min max
    
    steps:
      - name: Agent Identity
        run: |
          echo "ğŸ¤– Running on: $(hostname)"
          echo "ğŸ• Start time: $(date -u)"
          echo "ğŸ” Loop: continuous-24h+3s"

      - name: Do 24h work
        run: |
          # Sleep for 24 hours + 3 seconds
          echo "ğŸ’¤ Sleeping 86403s (24h+3s)..."
          sleep 86403
          echo "âœ… Work cycle complete at $(date -u)"

      - name: Self-retrigger
        if: always()
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh workflow run continuous-loop.yml \
            --repo ${{ github.repository }} \
            --ref ${{ github.ref_name }} || true
          echo "ğŸ” Retriggered at $(date -u)"
