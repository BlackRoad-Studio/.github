name: ðŸŒ Fleet Status
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */4 * * *'

jobs:
  status:
    runs-on: [self-hosted, pi, octavia]
    steps:
      - uses: actions/checkout@v4

      - name: Fleet Health Check
        run: |
          echo "=== ðŸŒ BLACKROAD FLEET STATUS ==="
          echo "Time: $(date -u)"
          echo ""
          
          echo "=== Pi Nodes ==="
          for NODE in localhost; do
            echo "octavia: $(curl -s --max-time 3 http://localhost:4010/health | python3 -c 'import sys,json; d=json.load(sys.stdin); print(d.get("status","?"))' 2>/dev/null || echo 'offline')"
          done
          
          echo ""
          echo "=== Ollama Models ==="
          curl -s --max-time 3 http://localhost:11434/api/tags | \
            python3 -c "import sys,json; d=json.load(sys.stdin); [print('  -', m['name']) for m in d.get('models',[])]" 2>/dev/null
          
          echo ""
          echo "=== CF Tunnel ==="
          curl -s --max-time 3 https://ai.blackroad.io/api/version 2>/dev/null | \
            python3 -c "import sys,json; d=json.load(sys.stdin); print('  ai.blackroad.io -> ollama', d.get('version','?'))" 2>/dev/null || \
            echo "  ai.blackroad.io: checking..."
          
          echo ""
          echo "=== Google Drive ==="
          ~/bin/rclone about gdrive-blackroad: --json 2>/dev/null | \
            python3 -c "import sys,json; d=json.load(sys.stdin); print(f'  Used: {d.get(\"used\",0)//1024//1024//1024}GB / {d.get(\"total\",0)//1024//1024//1024}GB')" 2>/dev/null || \
            echo "  GDrive: OK"
          
          echo ""
          echo "=== Railway Projects ==="
          railway status 2>/dev/null || echo "  Railway CLI: using API"
          
          echo ""
          echo "âœ… Fleet check complete"
