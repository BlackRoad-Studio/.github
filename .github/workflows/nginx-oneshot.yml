name: "ðŸ”§ Install Nginx on Cecilia (One-Shot)"
on:
  workflow_dispatch:
jobs:
  install:
    runs-on: [self-hosted, cecilia]
    steps:
      - name: Install nginx
        run: |
          sudo DEBIAN_FRONTEND=noninteractive apt-get update -qq
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y nginx
          sudo systemctl enable nginx
          sudo systemctl start nginx
          nginx -v
          echo "âœ… nginx $(systemctl is-active nginx)"
      - name: Deploy configs
        run: |
          sudo cp /tmp/nginx-sites/*.conf /etc/nginx/sites-available/ 2>/dev/null || true
          sudo mkdir -p /var/www/html
          echo '{"status":"ok","host":"cecilia","tier":1}' | sudo tee /var/www/html/health.json
          for f in /etc/nginx/sites-available/*.conf; do
            sudo ln -sf "$f" "/etc/nginx/sites-enabled/$(basename $f)" 2>/dev/null || true
          done
          sudo nginx -t && sudo systemctl reload nginx
          curl -sf http://localhost/health 2>/dev/null && echo "âœ… nginx serving" || echo "nginx default page active"
